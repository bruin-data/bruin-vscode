{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/bruin-data/bruin/pkg/pipeline/task-definition-yaml",
  "$ref": "#/$defs/TaskDefinitionYaml",
  "$defs": {
    "TaskDefinitionYaml": {
      "properties": {
        "name": {
          "type": "string"
        },
        "uri": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "type": {
          "type": "string"
        },
        "run": {
          "type": "string"
        },
        "depends": {
          "$ref": "#/$defs/depends"
        },
        "parameters": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        },
        "connections": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        },
        "secrets": {
          "items": {
            "$ref": "#/$defs/secretMapping"
          },
          "type": "array"
        },
        "connection": {
          "type": "string"
        },
        "image": {
          "type": "string"
        },
        "instance": {
          "type": "string"
        },
        "materialization": {
          "$ref": "#/$defs/materialization"
        },
        "owner": {
          "type": "string"
        },
        "columns": {
          "items": {
            "$ref": "#/$defs/column"
          },
          "type": "array"
        },
        "custom_checks": {
          "items": {
            "$ref": "#/$defs/customCheck"
          },
          "type": "array"
        },
        "tags": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "snowflake": {
          "$ref": "#/$defs/snowflake"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "name"
      ]
    },
    "clusterBy": {
      "items": {
        "type": "string"
      },
      "type": "array"
    },
    "column": {
      "properties": {
        "extends": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "type": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "checks": {
          "items": {
            "$ref": "#/$defs/columnCheck"
          },
          "type": "array"
        },
        "primary_key": {
          "type": "boolean"
        },
        "update_on_merge": {
          "type": "boolean"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "extends",
        "name",
        "type",
        "description",
        "checks",
        "primary_key",
        "update_on_merge"
      ]
    },
    "columnCheck": {
      "properties": {
        "name": {
          "type": "string"
        },
        "value": {
          "$ref": "#/$defs/columnCheckValue"
        },
        "blocking": {
          "type": "boolean"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "name",
        "value",
        "blocking"
      ]
    },
    "columnCheckValue": {
      "properties": {
        "IntArray": {
          "items": {
            "type": "integer"
          },
          "type": "array"
        },
        "Int": {
          "type": "integer"
        },
        "Float": {
          "type": "number"
        },
        "StringArray": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "String": {
          "type": "string"
        },
        "Bool": {
          "type": "boolean"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "IntArray",
        "Int",
        "Float",
        "StringArray",
        "String",
        "Bool"
      ]
    },
    "customCheck": {
      "properties": {
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "query": {
          "type": "string"
        },
        "value": {
          "type": "integer"
        },
        "blocking": {
          "type": "boolean"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "name",
        "description",
        "query",
        "value",
        "blocking"
      ]
    },
    "depends": {
      "items": {
        "$ref": "#/$defs/upstream"
      },
      "type": "array"
    },
    "materialization": {
      "properties": {
        "type": {
          "type": "string"
        },
        "strategy": {
          "type": "string"
        },
        "partition_by": {
          "type": "string"
        },
        "cluster_by": {
          "$ref": "#/$defs/clusterBy"
        },
        "incremental_key": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "type",
        "strategy",
        "partition_by",
        "cluster_by",
        "incremental_key"
      ]
    },
    "secretMapping": {
      "properties": {
        "key": {
          "type": "string"
        },
        "inject_as": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "key",
        "inject_as"
      ]
    },
    "snowflake": {
      "properties": {
        "warehouse": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "warehouse"
      ]
    },
    "upstream": {
      "properties": {
        "value": {
          "type": "string"
        },
        "type": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "type": "object",
      "required": [
        "value",
        "type"
      ]
    }
  }
}